<!doctype html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DTND0ZT0K6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-DTND0ZT0K6');
    </script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hourly Electricity Pricing — PG&E Pilot</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="wrap">
      <header>
        <div>
          <h1>Hourly Electricity Pricing — PG&E Pilot</h1>
          <div class="sub">Uses GridX “getPricing” (market=DAM, program=CalFUSE) with CCA and circuit ID. Defaults to <strong>today</strong> in Pacific Time.</div>
        </div>
        <div class="pill" id="tz-pill"></div>
      </header>

      <div class="card">
        <div class="controls">
          <div class="field">
            <label>Representative Circuit ID (9 digits, include leading zeros)</label>
            <input id="circuit" class="mono" value="042211101" maxlength="9" />
          </div>
          <div class="field">
            <label>Rate name</label>
            <select id="ratename">
              <option value="EV2A" selected>EV2A</option>
              <option value="EV2AS">EV2AS</option>
              <option value="BEV1">BEV1</option>
              <option value="BEV2P">BEV2P</option>
              <option value="BEV2S">BEV2S</option>
              <option value="B10P">B10P</option>
              <option value="B10S">B10S</option>
              <option value="B19P">B19P</option>
              <option value="B19S">B19S</option>
              <option value="B20P">B20P</option>
              <option value="B20S">B20S</option>
            </select>
          </div>
          <div class="field">
            <label>CCA (optional)</label>
            <select id="cca">
              <option value="">— none —</option>
              <option value="MCE" selected>MCE</option>
              <option value="PCE">PCE</option>
              <option value="AVA">AVA</option>
              <option value="SVCE">SVCE</option>
              <option value="VCE">VCE</option>
              <option value="SJCE">SJCE</option>
              <option value="3CE">3CE</option>
              <option value="PIO">PIO</option>
            </select>
          </div>
          <div class="field">
            <label>Environment</label>
            <select id="env">
              <option value="prod" selected>Production</option>
              <option value="stage">Stage (test)</option>
            </select>
          </div>
          <div class="field">
            <label>Utility</label>
            <input id="utility" value="PGE" />
          </div>
          <div class="field">
            <label>Program</label>
            <input id="program" value="CalFUSE" />
          </div>
          <div class="field wide">
            <label>Day (PT)</label>
            <div class="row">
              <button class="btn toggle" id="btnYesterday" title="Load yesterday (PT)">Yesterday</button>
              <button class="btn toggle active" id="btnToday" title="Load today (PT)">Today</button>
              <button class="btn toggle" id="btnTomorrow" title="Load tomorrow (PT)">Tomorrow</button>
              <button class="btn toggle" id="btnCustom" title="Pick any date (PT)">Custom</button>
              <input id="customDay" type="date" class="mono" style="display:none;" />
              <span class="help">Based on Pacific Time. Loads immediately on click.</span>
            </div>
          </div>
          <div class="field narrow" style="align-self:end">
            <button class="btn" id="loadBtn" title="Refresh current day">Reload</button>
          </div>
        </div>
        <div class="status" id="status">
          <div class="dot" id="dot"></div>
          <div class="help" id="statusText">Waiting to load…</div>
        </div>

        <div class="chart-wrap">
          <canvas id="chart"></canvas>
          <div class="help" id="chartCaption">Price shown in ¢/kWh</div>
          <div id="chartTooltip" class="tooltip" style="display:none;"></div>
        </div>

        <div class="scroll" style="max-height: 60vh;">
          <table>
            <thead>
              <tr>
                <th>Interval start (PT)</th>
                <th>Interval start (Your TZ)</th>
                <th class="mono">Price ($/kWh)</th>
                <th class="mono">Price (¢/kWh)</th>
                <th class="mono">Status</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
        <div class="footnote">Note: Day-ahead prices are published ~4:30pm PT (forecast) and finalized ~6:30pm PT daily. If you query before prices are published, you may see empty results (HTTP 204).</div>
      </div>
    </div>

    <script src="app.js" defer></script>
  </body>
</html>
